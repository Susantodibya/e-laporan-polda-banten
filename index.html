<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Terpadu Polda Banten</title>

    <!-- Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

    <style>
        /* Global & Dashboard Style */
        :root {
            --primary-blue: #4A90E2;
            --light-blue: #EBF5FF;
            --dark-blue: #0056b3;
            --text-dark: #333333;
            --text-medium: #555555;
            --bg-light: #F0F2F5;
            --content-bg: #FFFFFF;
            --border-light: #E0E0E0;
            --shadow-light: rgba(0, 0, 0, 0.08);
            --shadow-medium: rgba(0, 0, 0, 0.15);
            --red-danger: #dc3545;
            --gemini-green: #34A853;
            --orange-edit: #ffc107;
            --dark-orange-edit: #e0a800;
        }

        body {
            font-family: 'Inter', sans-serif;
            transition: background 0.3s;
        }

        /* Navigation Sidebar */
        .sidebar-active {
            background-color: #1e293b;
            color: #fbbf24;
            border-right: 4px solid #fbbf24;
        }

        /* APP 1: Ketahanan Pangan Styles */
        .kp-body {
            background: radial-gradient(circle at top right, #1e293b, #0f172a);
            min-height: 100vh;
            padding: 20px;
            border-radius: 2rem;
        }

        .kp-glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .kp-neo-input {
            background: #020617;
            border: 1px solid #334155;
            color: #f8fafc;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }

        .kp-neo-input:focus {
            border-color: #eab308;
            box-shadow: 0 0 10px rgba(234, 179, 8, 0.2);
            outline: none;
        }

        .kp-section-card {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 1.5rem;
            padding: 1.5rem;
            border: 1px solid rgba(51, 65, 85, 0.5);
            margin-bottom: 1.5rem;
        }

        .kp-entry-row {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 1rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
            border-left: 3px solid #eab308;
            color: white;
        }

        /* APP 2 & 3 Tables & Common Styles */
        .table-custom {
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* APP 3 SDM Specific Styles */
        #sdm-output {
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            position: relative;
            overflow: hidden;
            font-size: 0.95rem;
        }

        .hadir-item {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: grab;
            background: #f8fafc;
            padding: 4px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .hadir-item.dragging {
            opacity: 0.5;
            background: #e2e8f0;
            cursor: grabbing;
        }

        .delete-participant-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--red-danger);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-shrink: 0;
        }

        .web-watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-25deg);
            font-size: 3em;
            color: rgba(0, 0, 0, 0.05);
            font-weight: bold;
            pointer-events: none;
            white-space: nowrap;
            z-index: 1;
        }

        .pdf-watermark {
            position: absolute;
            bottom: 20px;
            right: 20px;
            font-size: 12px;
            color: rgba(0, 0, 0, 0.3);
            font-weight: bold;
            transform: rotate(-15deg);
        }

        /* Modal Overlay */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            visibility: hidden;
            opacity: 0;
            transition: 0.3s;
        }

        .modal-overlay.visible {
            visibility: visible;
            opacity: 1;
        }

        /* Tab Switching */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>

<body class="bg-slate-50 flex flex-col md:flex-row min-h-screen">

    <!-- Sidebar Navigation -->
    <aside class="w-full md:w-64 bg-slate-900 text-white flex-shrink-0 z-50">
        <div class="p-6">
            <div class="flex items-center gap-3 mb-10">
                <!-- Text -->
                <img src="logo.png" alt="Logo Polda Banten" class="w-12 h-12 object-contain">
                <div>
                    <h1 class="font-black text-xl leading-tight tracking-tight">
                        POLDA
                        <br>
                        <span class="text-yellow-500">BANTEN</span>
                    </h1>
                </div>

            </div>
            <nav class="space-y-2">
                <button onclick="switchTab('dashboard')" id="nav-dashboard"
                    class="sidebar-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all sidebar-active">
                    <span>üè† Dashboard</span>
                </button>
                <button onclick="switchTab('pangan')" id="nav-pangan"
                    class="sidebar-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-slate-800">
                    <span>üåæ Ketahanan Pangan</span>
                </button>
                <button onclick="switchTab('harian')" id="nav-harian"
                    class="sidebar-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-slate-800">
                    <span>üìÖ Input Harian</span>
                </button>
                <button onclick="switchTab('sdm')" id="nav-sdm"
                    class="sidebar-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-slate-800">
                    <span>üëÆ e-Laporan SDM</span>
                </button>
            </nav>
        </div>
    </aside>

    <!-- Main Container -->
    <main class="flex-1 p-4 md:p-8 overflow-y-auto max-h-screen">

        <!-- TAB 0: DASHBOARD HOME -->
        <div id="tab-dashboard" class="tab-content active relative overflow-hidden">
            <div id="particles-js" class="absolute inset-0 z-0 opacity-50 pointer-events-none"></div>
            <div class="max-w-4xl mx-auto py-12 text-center relative z-10">
                <h1 class="text-4xl font-black text-slate-800 mb-4 tracking-tight">Pusat Pelaporan Digital Terpadu</h1>
                <p class="text-slate-500 text-lg mb-12">Silakan pilih modul aplikasi yang ingin digunakan melalui
                    navigasi sebelah kiri.</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                        <div class="text-3xl mb-4">üåæ</div>
                        <h3 class="font-bold text-slate-800">Ketahanan Pangan</h3>
                        <p class="text-xs text-slate-500 mt-2">Laporan luas lahan, produksi harian jagung, dan harga
                            pasar.</p>
                    </div>
                    <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                        <div class="text-3xl mb-4">üìÖ</div>
                        <h3 class="font-bold text-slate-800">Input Harian</h3>
                        <p class="text-xs text-slate-500 mt-2">Otomatisasi pengisian jurnal kegiatan harian personil.
                        </p>
                    </div>
                    <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                        <div class="text-3xl mb-4">üëÆ</div>
                        <h3 class="font-bold text-slate-800">e-Laporan SDM</h3>
                        <p class="text-xs text-slate-500 mt-2">Manajemen pelaporan kegiatan dinas dengan PDF & AI.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 1: KETAHANAN PANGAN -->
        <div id="tab-pangan" class="tab-content">
            <div class="kp-body">
                <datalist id="list-polres">
                    <option value="Polresta Tangerang">
                    <option value="Polres Cilegon">
                    <option value="Polres Serang Kota">
                    <option value="Polres Serang">
                    <option value="Polres Pandeglang">
                    <option value="Polres Lebak">
                </datalist>

                <div class="max-w-5xl mx-auto kp-glass p-6 md:p-10 rounded-[2rem] shadow-2xl">
                    <header class="text-center mb-10">
                        <div
                            class="inline-block bg-yellow-500 text-black text-[10px] font-bold px-3 py-1 rounded-full mb-3 uppercase tracking-widest">
                            Unit Input Terpadu</div>
                        <h1 class="text-3xl md:text-4xl font-black text-yellow-500 tracking-tighter italic uppercase">
                            Digital Reporting <span
                                class="text-white block not-italic font-light text-xl mt-1">Ketahanan Pangan Polda
                                Banten</span>
                        </h1>
                    </header>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8 pb-6 border-b border-slate-700">
                        <div class="space-y-2">
                            <label class="text-xs font-bold text-yellow-500 uppercase tracking-widest">Nama Kluster
                                (Custom)</label>
                            <input type="text" id="kp-kluster" value="KLUSTER 1"
                                class="w-full kp-neo-input rounded-xl px-4 py-3">
                        </div>
                        <div class="md:col-span-2 space-y-2">
                            <label class="text-xs font-bold text-yellow-500 uppercase tracking-widest">Tanggal
                                Laporan</label>
                            <input type="date" id="kp-tanggal" class="w-full kp-neo-input rounded-xl px-4 py-3">
                        </div>
                    </div>

                    <div id="kp-program-container" class="space-y-6">
                        <div class="kp-section-card">
                            <div class="flex justify-between items-center mb-4">
                                <label class="text-xs font-bold text-yellow-500 uppercase tracking-widest">1. Penambahan
                                    Lahan / Giat Tanam</label>
                                <button onclick="pangan_addEntry('kp-lahan-list', 'Contoh: seluas 2 Ha')"
                                    class="text-[10px] bg-yellow-500/20 text-yellow-500 px-3 py-1 rounded-lg hover:bg-yellow-500 transition-all">+
                                    TAMBAH UNIT</button>
                            </div>
                            <div id="kp-lahan-list" class="space-y-2"></div>
                        </div>

                        <div class="kp-section-card">
                            <div class="flex justify-between items-center mb-4">
                                <label class="text-xs font-bold text-yellow-500 uppercase tracking-widest">2. Produksi
                                    Harian / Panen</label>
                                <button onclick="pangan_addEntry('kp-panen-list', 'Contoh: 2 Ton')"
                                    class="text-[10px] bg-yellow-500/20 text-yellow-500 px-3 py-1 rounded-lg hover:bg-yellow-500 transition-all">+
                                    TAMBAH UNIT</button>
                            </div>
                            <div id="kp-panen-list" class="space-y-2"></div>
                        </div>

                        <div class="kp-section-card">
                            <label class="text-xs font-bold text-yellow-500 uppercase tracking-widest mb-4 block">3.
                                Harga Jagung Pipilan 14% (Isi Manual)</label>
                            <div class="space-y-4">
                                <div><textarea id="kp-bulog_manual" placeholder="- Rp. 6.400 (Pipil Kering)..."
                                        class="w-full kp-neo-input rounded-xl px-4 py-3 h-24"></textarea></div>
                                <div><input type="text" id="kp-nonbulog" placeholder="Contoh: Rp. 6.000 s.d. Rp. 7.000"
                                        class="w-full kp-neo-input rounded-xl px-4 py-3"></div>
                            </div>
                        </div>

                        <div class="kp-section-card">
                            <label class="text-xs font-bold text-yellow-500 uppercase tracking-widest mb-4 block">4.
                                Serapan Jagung</label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <input type="text" id="kp-serap_bulog" placeholder="Serapan Bulog: 10 Ton"
                                    class="kp-neo-input rounded-xl px-4 py-3">
                                <input type="text" id="kp-serap_pabrik" placeholder="Serapan Pabrik: 1 Ton"
                                    class="kp-neo-input rounded-xl px-4 py-3">
                            </div>
                        </div>

                        <div class="kp-section-card">
                            <label class="text-xs font-bold text-yellow-500 uppercase tracking-widest mb-6 block">5.
                                Kegiatan Harian Polda/Polres</label>
                            <div class="space-y-4">
                                <div>
                                    <div class="flex justify-between mb-2"><span
                                            class="text-[10px] font-bold text-slate-400 uppercase">a.
                                            Tanam</span><button onclick="pangan_addEntry('kp-giat-tanam-list')"
                                            class="text-[9px] border border-slate-600 px-2 py-1 rounded">+ UNIT</button>
                                    </div>
                                    <div id="kp-giat-tanam-list" class="space-y-2"></div>
                                </div>
                                <div>
                                    <div class="flex justify-between mb-2"><span
                                            class="text-[10px] font-bold text-slate-400 uppercase">b.
                                            Panen</span><button onclick="pangan_addEntry('kp-giat-panen-list')"
                                            class="text-[9px] border border-slate-600 px-2 py-1 rounded">+ UNIT</button>
                                    </div>
                                    <div id="kp-giat-panen-list" class="space-y-2"></div>
                                </div>
                                <div><textarea id="kp-giat-lain" placeholder="Kegiatan lainnya..."
                                        class="w-full kp-neo-input rounded-xl px-4 py-3 h-20"></textarea></div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-10 flex flex-col md:flex-row gap-4">
                        <button onclick="pangan_generate()"
                            class="flex-[2] bg-yellow-500 hover:bg-yellow-400 text-black font-black py-4 rounded-2xl transition-all shadow-lg text-lg uppercase">Generate
                            Format WA</button>
                        <button onclick="pangan_copyText()"
                            class="flex-1 border-2 border-yellow-500 text-yellow-500 font-bold py-4 rounded-2xl">SALIN
                            TEKS</button>
                    </div>

                    <div id="kp-outputContainer" class="hidden mt-10">
                        <div class="bg-black/80 border border-yellow-500/30 p-6 rounded-2xl shadow-inner font-mono text-sm text-green-400 whitespace-pre-wrap"
                            id="kp-hasil"></div>
                    </div>
                </div>
                <div id="pangan-datalist-container"></div>
            </div>
        </div>

        <!-- TAB 2: INPUT HARIAN -->
        <div id="tab-harian" class="tab-content">
            <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-4 text-center">Form Pengisian Harian Otomatis</h1>
                <p class="text-gray-500 mb-6 text-center">Masukkan tanggal di setiap baris pertama, data template akan
                    otomatis terisi.</p>
                <div class="flex flex-col md:flex-row justify-center space-y-4 md:space-y-0 md:space-x-4">
                    <button id="harian-addRowButton"
                        class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-6 rounded-full shadow-md flex items-center gap-2">
                        <span>‚ûï Tambah Data Harian</span>
                    </button>
                    <button id="harian-exportButton"
                        class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-6 rounded-full shadow-md flex items-center gap-2">
                        <span>üìä Export ke Excel</span>
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 overflow-x-auto">
                <table id="harian-dataTable" class="w-full text-sm text-left text-gray-500 table-custom">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                        <tr>
                            <th class="py-3 px-6">Tanggal</th>
                            <th class="py-3 px-6">Kategori</th>
                            <th class="py-3 px-6">Uraian</th>
                            <th class="py-3 px-6 text-center">Giat</th>
                            <th class="py-3 px-6 text-center">Waktu (Jam)</th>
                            <th class="py-3 px-6">Keterangan</th>
                        </tr>
                    </thead>
                    <tbody id="harian-tableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- TAB 3: E-LAPORAN SDM (MODUL LENGKAP) -->
        <div id="tab-sdm" class="tab-content">
            <div class="bg-white rounded-xl shadow-lg p-8 mb-8 border border-slate-200">
                <h2 class="text-3xl font-bold text-blue-600 mb-6 text-center">e-Laporan Kegiatan SDM Polda Banten</h2>

                <form id="sdm-reportForm" class="space-y-4">
                    <input type="hidden" id="sdm-editingReportId" value="">

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold mb-1">Jenis Kegiatan:</label>
                            <input type="text" id="sdm-jenis" placeholder="Contoh: Rapat Koordinasi, Supervisi"
                                class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-blue-400 outline-none"
                                required>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-1">Kepada Yth:</label>
                            <select id="sdm-kepada" class="w-full border rounded-lg p-2">
                                <option value="Kapolda Banten">Kapolda Banten</option>
                                <option value="Wakapolda Banten">Wakapolda Banten</option>
                                <option value="Karo SDM Polda Banten" selected>Karo SDM Polda Banten</option>
                                <option value="Irwasda Polda Banten">Irwasda Polda Banten</option>
                            </select>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-semibold mb-1">Dari:</label>
                            <select id="sdm-dari" class="w-full border rounded-lg p-2">
                                <option value="Kapolda Banten">Kapolda Banten</option>
                                <option value="Karo SDM Polda Banten">Karo SDM Polda Banten</option>
                                <option value="Kabagbinkar Ro SDM Polda Banten" selected>Kabagbinkar Ro SDM Polda Banten
                                </option>
                                <option value="Kasubbagmutjab Bag Binkar">Kasubbagmutjab Bag Binkar</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-1">Hari, Tanggal:</label>
                            <input type="date" id="sdm-tanggal" class="w-full border rounded-lg p-2" required>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-1">Waktu:</label>
                            <input type="time" id="sdm-waktu" class="w-full border rounded-lg p-2" required>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold mb-1">Tempat:</label>
                        <input type="text" id="sdm-tempat" placeholder="Contoh: Ruang Kerja Kabagbinkar"
                            class="w-full border rounded-lg p-2" required>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold mb-1">Pimpinan Kegiatan:</label>
                            <input list="sdm-pimpinan-options" id="sdm-pimpinan"
                                placeholder="Pilih atau ketik jabatan..." class="w-full border rounded-lg p-2" required>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-1">Sapaan Akhir:</label>
                            <select id="sdm-sapaan" class="w-full border rounded-lg p-2">
                                <option value="Komandan" selected>Komandan</option>
                                <option value="Jenderal">Jenderal</option>
                            </select>
                        </div>
                    </div>

                    <div class="space-y-2">
                        <label class="block text-sm font-semibold">Dihadiri oleh (Geser untuk ubah urutan):</label>
                        <div id="sdm-daftar-hadir-container"
                            class="space-y-2 border p-2 rounded-lg bg-slate-50 min-h-[50px]"></div>
                        <button type="button" onclick="sdm_tambahPeserta()"
                            class="text-xs bg-slate-200 px-4 py-2 rounded-lg border border-slate-300 hover:bg-slate-300 font-bold">+
                            Tambah Peserta</button>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold mb-1">Hasil yang Didapat:</label>
                        <textarea id="sdm-hasil" placeholder="Tulis ringkasan hasil kegiatan secara poin..."
                            class="w-full border rounded-lg p-3 h-32" required></textarea>
                        <button type="button" id="sdm-elaborateHasilBtn" onclick="sdm_elaborateHasil()"
                            class="mt-2 bg-emerald-600 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-emerald-700">‚ú®
                            Perluas Hasil (AI)</button>
                    </div>

                    <div class="flex flex-wrap gap-2 justify-center py-6">
                        <button type="button" id="sdm-mainActionButton" onclick="sdm_generateLaporan()"
                            class="bg-blue-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg">Buat
                            Laporan</button>
                        <button type="button" onclick="sdm_downloadPDF()"
                            class="bg-slate-800 text-white px-6 py-3 rounded-xl font-bold shadow-lg">Download
                            PDF</button>
                        <button type="button" onclick="sdm_copyLaporan()"
                            class="border-2 border-blue-600 text-blue-600 px-6 py-3 rounded-xl font-bold">Salin
                            Teks</button>
                        <button type="button" id="sdm-cancelEditButton" style="display:none;" onclick="sdm_cancelEdit()"
                            class="bg-gray-400 text-white px-6 py-3 rounded-xl font-bold">Batal Edit</button>
                    </div>
                </form>

                <hr class="my-8">

                <h3 class="font-bold text-center mb-4 text-lg">Pratinjau Laporan:</h3>
                <div id="sdm-output" class="bg-white border p-8 rounded-xl min-h-[300px] shadow-inner relative">
                    <div id="sdm-reportDisplayArea"></div>
                </div>

                <hr class="my-8">

                <h3 class="font-bold text-center mb-6 text-lg">Riwayat Laporan:</h3>
                <div id="sdm-history-section">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4 items-end">
                        <div class="md:col-span-1">
                            <label class="text-xs font-bold text-slate-400 block mb-1">Cari Kata Kunci:</label>
                            <input type="text" id="sdm-searchQuery" placeholder="Cari..." onkeyup="sdm_renderHistory()"
                                class="w-full border rounded-lg p-2 text-sm">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-slate-400 block mb-1">Kegiatan:</label>
                            <select id="sdm-filterJenis" onchange="sdm_renderHistory()"
                                class="w-full border rounded-lg p-2 text-sm">
                                <option value="">Semua</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-xs font-bold text-slate-400 block mb-1">Tujuan:</label>
                            <select id="sdm-filterKepada" onchange="sdm_renderHistory()"
                                class="w-full border rounded-lg p-2 text-sm">
                                <option value="">Semua</option>
                            </select>
                        </div>
                        <button onclick="sdm_clearAllHistory()"
                            class="bg-red-500 text-white text-xs px-4 py-3 rounded-lg font-bold">Hapus Semua</button>
                    </div>
                    <div id="sdm-history" class="space-y-4"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal System -->
    <div id="customModal" class="modal-overlay">
        <div class="bg-white rounded-2xl p-8 max-w-sm w-full text-center shadow-2xl">
            <h4 id="modalTitle" class="text-xl font-bold text-slate-800 mb-2"></h4>
            <p id="modalMessage" class="text-slate-500 mb-6"></p>
            <div class="flex justify-center gap-4" id="modalButtons">
                <button id="modalConfirmBtn" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-bold">OK</button>
                <button id="modalCancelBtn"
                    class="bg-slate-200 text-slate-800 px-6 py-2 rounded-lg font-bold">Batal</button>
            </div>
        </div>
    </div>

    <!-- DATA ASSETS -->
    <datalist id="sdm-pimpinan-options">
        <option value="Kapolda Banten">
        <option value="Wakapolda Banten">
        <option value="Karo SDM Polda Banten">
        <option value="Kabagbinkar Ro SDM Polda Banten">
    </datalist>

    <datalist id="sdm-daftar-hadir">
        <!-- Jabatan Lengkap -->
        <option value="Karo SDM Polda Banten">
        <option value="Wakapolda Banten">
        <option value="Kapolda Banten">
        <option value="Irwasda Polda Banten">
        <option value="Kabagbinkar Ro SDM Polda Banten">
        <option value="Kasubbagmutjab Bag Binkar Ro SDM Polda Banten">
        <option value="Staff Bagbinkar Ro SDM Polda Banten">
        <option value="Kasubbagsisminkar">
        <option value="Kabag Dalpers">
        <option value="Dansatbrimob Polda Banten">
        <option value="Dirintelkam Polda Banten">
        <option value="Dirlantas Polda Banten">
        <option value="Dirpamobvit Polda Banten">
        <option value="Dirpolairud Polda Banten">
        <option value="Dirreskrimum Polda Banten">
        <option value="Dirreskrimsus Polda Banten">
        <option value="Dirresnarkoba Polda Banten">
        <option value="Dirsamapta Polda Banten">
        <option value="Kabidhumas Polda Banten">
        <option value="Kabidpropam Polda Banten">
        <option value="Kabid TIK Polda Banten">
        <option value="Karorena Polda Banten">
        <option value="Karolog Polda Banten">
        <option value="Karoops Polda Banten">
        <option value="Kapolresta Tangerang Polda Banten">
        <option value="Kapolresta Serang Kota Polda Banten">
        <option value="Kapolres Serang Polda Banten">
        <option value="Kapolres Cilegon Polda Banten">
        <option value="Kapolres Pandeglang Polda Banten">
        <option value="Kapolres Lebak Polda Banten">
            <!-- ... list dilanjutkan secara otomatis oleh JS ... -->
    </datalist>

    <script>
        // --- Dashboard Navigation ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.sidebar-btn').forEach(el => el.classList.remove('sidebar-active'));

            document.getElementById('tab-' + tabId).classList.add('active');
            document.getElementById('nav-' + tabId).classList.add('sidebar-active');
        }

        function showModal(message, type, onConfirm = null) {
            const modal = document.getElementById('customModal');
            document.getElementById('modalMessage').textContent = message;
            document.getElementById('modalTitle').textContent = type === 'confirm' ? 'Konfirmasi' : 'Informasi';
            const confirmBtn = document.getElementById('modalConfirmBtn');
            const cancelBtn = document.getElementById('modalCancelBtn');

            cancelBtn.style.display = type === 'confirm' ? 'block' : 'none';
            confirmBtn.onclick = () => { modal.classList.remove('visible'); if (onConfirm) onConfirm(); };
            cancelBtn.onclick = () => { modal.classList.remove('visible'); };

            modal.classList.add('visible');
        }

        // ==========================================
        // APP 1: KETAHANAN PANGAN LOGIC
        // ==========================================
        const dataPolsek = {
            "Polresta Tangerang": ["Polsek Tigaraksa", "Polsek Balaraja", "Polsek Cikupa", "Polsek Panongan", "Polsek Pasar Kemis", "Polsek Rajeg", "Polsek Mauk", "Polsek Kronjo", "Polsek Kresek"],
            "Polres Cilegon": ["Polsek Cilegon", "Polsek Pulomerak", "Polsek Anyar", "Polsek Mancak", "Polsek Bojonegara", "Polsek Cinangka", "Polsek Ciwandan", "Polsek Purwakarta"],
            "Polres Serang Kota": ["Polsek Serang", "Polsek Cipocok Jaya", "Polsek Curug", "Polsek Walantaka", "Polsek Kasemen", "Polsek Taktakan", "Polsek Kramatwatu"],
            "Polres Serang": ["Polsek Ciruas", "Polsek Kragilan", "Polsek Pontang", "Polsek Tirtayasa", "Polsek Cikande", "Polsek Petir", "Polsek Tanara", "Polsek Padarincang"],
            "Polres Pandeglang": ["Polsek Pandeglang", "Polsek Cadasari", "Polsek Labuan", "Polsek Pagelaran", "Polsek Panimbang", "Polsek Menes", "Polsek Jiput", "Polsek Cibaliung"],
            "Polres Lebak": ["Polsek Rangkasbitung", "Polsek Maja", "Polsek Cipanas", "Polsek Malingping", "Polsek Bayah", "Polsek Sajira", "Polsek Bojongmanik", "Polsek Warunggunung"]
        };

        function pangan_addEntry(containerId, placeholder = "Detail data...") {
            const container = document.getElementById(containerId);
            const rowId = 'kp-row-' + Math.random().toString(36).substr(2, 9);
            const datalistId = 'kp-dl-' + rowId;
            const div = document.createElement('div');
            div.className = 'kp-entry-row grid grid-cols-1 md:grid-cols-3 gap-2 items-center';
            div.id = rowId;
            div.innerHTML = `
                <input type="text" list="list-polres" placeholder="Polres" oninput="pangan_handlePolresInput('${rowId}', '${datalistId}')" class="kp-neo-input rounded-lg px-3 py-2 polres-val">
                <input type="text" list="${datalistId}" placeholder="Polsek" class="kp-neo-input rounded-lg px-3 py-2 polsek-val">
                <div class="flex gap-2">
                    <input type="text" placeholder="${placeholder}" class="kp-neo-input rounded-lg px-3 py-2 flex-1 data-val">
                    <button onclick="pangan_removeRow('${rowId}', '${datalistId}')" class="text-red-500 font-bold px-2">√ó</button>
                </div>`;
            const dl = document.createElement('datalist');
            dl.id = datalistId;
            document.getElementById('pangan-datalist-container').appendChild(dl);
            container.appendChild(div);
        }

        function pangan_handlePolresInput(rowId, dlId) {
            const val = document.getElementById(rowId).querySelector('.polres-val').value;
            const dl = document.getElementById(dlId);
            dl.innerHTML = '';
            if (dataPolsek[val]) dataPolsek[val].forEach(p => { const o = document.createElement('option'); o.value = p; dl.appendChild(o); });
        }

        function pangan_removeRow(rowId, dlId) { document.getElementById(rowId).remove(); const dl = document.getElementById(dlId); if (dl) dl.remove(); }

        function pangan_getEntriesText(id) {
            const rows = document.getElementById(id).querySelectorAll('.kp-entry-row');
            let res = [];
            rows.forEach(r => {
                const prs = r.querySelector('.polres-val').value;
                const psk = r.querySelector('.polsek-val').value;
                const val = r.querySelector('.data-val').value;
                if (prs && psk && val) res.push(`${psk}, ${prs} ${val}`);
            });
            return res;
        }

        function pangan_generate() {
            const kluster = document.getElementById('kp-kluster').value;
            const tglInput = document.getElementById('kp-tanggal').value;
            const d = new Date(tglInput);
            const months = ["JANUARI", "FEBRUARI", "MARET", "APRIL", "MEI", "JUNI", "JULI", "AGUSTUS", "SEPTEMBER", "OKTOBER", "NOVEMBER", "DESEMBER"];
            const tglFmt = isNaN(d.getTime()) ? "-" : `${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear()}`;

            const getVal = id => document.getElementById(id).value || "-";

            let text = `_*LAPORAN HARIAN PROGRAM POLRI DI BIDANG KETAHANAN PANGAN POLDA JAJARAN ${kluster.toUpperCase()} (${tglFmt})*_\n\n` +
                `*POLDA BANTEN*\n` +
                `1. Penambahan Lahan:\n${pangan_getEntriesText('kp-lahan-list').map(t => `- ${t}`).join('\n') || "-"}\n\n` +
                `2. Produksi Harian:\n${pangan_getEntriesText('kp-panen-list').map(t => `- ${t}`).join('\n') || "-"}\n\n` +
                `3. Harga Jagung:\n   a. Bulog: ${getVal('kp-bulog_manual')}\n   b. Diluar Bulog: ${getVal('kp-nonbulog')}\n\n` +
                `4. Serapan:\n   a. Bulog: ${getVal('kp-serap_bulog')}\n   b. Pabrik: ${getVal('kp-serap_pabrik')}\n\n` +
                `5. Kegiatan Harian:\n` +
                `   a. Tanam:\n${pangan_getEntriesText('kp-giat-tanam-list').map(t => `      - ${t}`).join('\n') || "      -"}\n` +
                `   b. Panen:\n${pangan_getEntriesText('kp-giat-panen-list').map(t => `      - ${t}`).join('\n') || "      -"}\n` +
                `   c. Lainnya: ${getVal('kp-giat-lain')}`;

            document.getElementById('kp-hasil').innerText = text;
            document.getElementById('kp-outputContainer').classList.remove('hidden');
        }

        function pangan_copyText() {
            const text = document.getElementById('kp-hasil').innerText;
            const temp = document.createElement("textarea");
            document.body.appendChild(temp);
            temp.value = text; temp.select(); document.execCommand("copy");
            document.body.removeChild(temp);
            showModal("Berhasil disalin ke clipboard!", 'alert');
        }

        // ==========================================
        // APP 2: INPUT HARIAN LOGIC
        // ==========================================
        const harian_template = [
            { k: 'giat', u: 'apel pagi', g: '6', w: '1', ket: '-' },
            { k: 'dok', u: 'Menata dan mengarsipkan surat msuk dan surat keluar', g: '12', w: '6', ket: '-' },
            { k: 'dok', u: 'Mendistribusikan surat ke jajaran Ro SDM sesuai disposisi Pimpinan', g: '12', w: '6', ket: '-' },
            { k: 'giat', u: 'apel siang', g: '6', w: '1', ket: '-' },
            { k: 'dok', u: 'membuat/menindaklanjuti surat sesuai disposisi pimpinan', g: '12', w: '6', ket: '-' },
            { k: 'dok', u: 'menerima, mempelajari dan mengagenda surat masuk', g: '12', w: '6', ket: '-' }
        ];
        let harian_counter = 0;

        function harian_addDataRows() {
            const blockId = harian_counter++;
            const tbody = document.getElementById('harian-tableBody');
            harian_template.forEach((data, index) => {
                const row = document.createElement('tr');
                row.className = 'bg-white border-b hover:bg-gray-50';
                row.setAttribute('data-block-id', blockId);

                let dateCol = index === 0
                    ? `<input type="date" class="border rounded p-1 w-36 harian-date-input" onchange="harian_syncDate(${blockId}, this.value)">`
                    : `<span class="harian-date-display text-gray-400 italic"></span>`;

                row.innerHTML = `
                    <td class="py-4 px-6">${dateCol}</td>
                    <td class="py-4 px-6">${data.k}</td>
                    <td class="py-4 px-6">${data.u}</td>
                    <td class="py-4 px-6 text-center">${data.g}</td>
                    <td class="py-4 px-6 text-center">${data.w}</td>
                    <td class="py-4 px-6">${data.ket}</td>`;
                tbody.appendChild(row);
            });
        }

        function harian_syncDate(blockId, val) {
            document.querySelectorAll(`tr[data-block-id="${blockId}"] .harian-date-display`).forEach(el => el.textContent = val);
        }

        function harian_exportExcel() {
            const table = document.getElementById('harian-dataTable');
            let csv = ["Tanggal;Kategori;Uraian;Giat;Jumlah Waktu;Keterangan"];
            const rows = table.querySelectorAll('tbody tr');
            rows.forEach(row => {
                const bId = row.getAttribute('data-block-id');
                const inp = row.querySelector('.harian-date-input');
                let d = inp ? inp.value : (document.querySelectorAll(`tr[data-block-id="${bId}"] .harian-date-display`)[0].textContent || '');
                const tds = row.querySelectorAll('td');
                csv.push(`\t${d};${tds[1].innerText};${tds[2].innerText};${tds[3].innerText};${tds[4].innerText};${tds[5].innerText}`);
            });
            const blob = new Blob(["\ufeff", csv.join('\n')], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = 'Laporan_Harian_Export.xls';
            link.click();
        }

        // ==========================================
        // APP 3: E-LAPORAN SDM (LOGIKA LENGKAP)
        // ==========================================
        let sdm_draggedItem = null;

        function sdm_tambahPeserta(val = "") {
            const container = document.getElementById("sdm-daftar-hadir-container");
            const div = document.createElement("div");
            div.className = "hadir-item";
            div.draggable = true;

            // Drag and Drop Handlers
            div.addEventListener('dragstart', function (e) { sdm_draggedItem = this; setTimeout(() => this.classList.add('dragging'), 0); });
            div.addEventListener('dragover', e => { e.preventDefault(); e.dataTransfer.dropEffect = 'move'; });
            div.addEventListener('drop', function (e) {
                e.preventDefault();
                if (this !== sdm_draggedItem) {
                    const nodes = Array.from(container.children);
                    const draggedIdx = nodes.indexOf(sdm_draggedItem);
                    const targetIdx = nodes.indexOf(this);
                    if (draggedIdx > targetIdx) container.insertBefore(sdm_draggedItem, this);
                    else container.insertBefore(sdm_draggedItem, this.nextSibling);
                }
            });
            div.addEventListener('dragend', function () { this.classList.remove('dragging'); sdm_draggedItem = null; });

            div.innerHTML = `
                <input type="text" list="sdm-daftar-hadir" class="hadir flex-1 p-2 bg-transparent text-sm outline-none" value="${val}" placeholder="Ketik atau pilih peserta...">
                <button type="button" class="delete-participant-btn" onclick="this.parentElement.remove()">√ó</button>`;

            container.appendChild(div);
        }

        function sdm_generateLaporan() {
            const idEdit = document.getElementById('sdm-editingReportId').value;
            const f = {
                jenis: document.getElementById('sdm-jenis').value.trim(),
                kepada: document.getElementById('sdm-kepada').value,
                dari: document.getElementById('sdm-dari').value,
                tgl: document.getElementById('sdm-tanggal').value,
                wkt: document.getElementById('sdm-waktu').value,
                tmp: document.getElementById('sdm-tempat').value.trim(),
                pim: document.getElementById('sdm-pimpinan').value.trim(),
                hasil: document.getElementById('sdm-hasil').value.trim(),
                sapaan: document.getElementById('sdm-sapaan').value,
                peserta: Array.from(document.querySelectorAll("#sdm-daftar-hadir-container .hadir")).map(i => i.value.trim()).filter(v => v)
            };

            if (!f.jenis || !f.tgl || !f.pim || !f.hasil) return showModal("Mohon lengkapi data utama laporan.", "alert");

            const dateObj = new Date(f.tgl + 'T00:00:00');
            const fmtTgl = dateObj.toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

            const content = `*Kepada Yth : ${f.kepada}*\n*Dari : ${f.dari}*\n\nAssalamualaikum Wr. Wb.\nSelamat siang ${f.sapaan}. Mohon izin melaporkan pelaksanaan ${f.jenis} dengan rincian sebagai berikut:\n\n*Pelaksanaan Kegiatan:*\n1. Hari, Tanggal: ${fmtTgl};\n2. Pukul : ${f.wkt} WIB s.d Selesai;\n3. Tempat : ${f.tmp};\n4. Pimpinan Kegiatan : ${f.pim}.\n\n*Dihadiri oleh:*\n${f.peserta.map((p, i) => `${i + 1}. ${p}`).join('\n')}\n\n*Hasil yang Didapat:*\n${f.hasil}\n\n*Penutup:*\nKegiatan berjalan dengan tertib dan lancar. Demikian yang dapat kami laporkan kepada ${f.sapaan}, dan kami haturkan terima kasih.\n(dokumentasi terlampir)\n\nWassalamu'alaikum Wr. Wb.\n\n*Biro SDM Polda Banten*\n*Kerja Ikhlas, Kerja Cerdas, Kerja Tuntas*`;

            document.getElementById('sdm-reportDisplayArea').innerHTML = content.replace(/\n/g, '<br>');
            sdm_addWebWatermark();

            if (idEdit) {
                let list = JSON.parse(localStorage.getItem("sdm_history") || "[]");
                const idx = list.findIndex(l => l.id == idEdit);
                if (idx !== -1) {
                    list[idx] = { id: idEdit, content: content, data: f, time: new Date().toLocaleString() };
                    localStorage.setItem("sdm_history", JSON.stringify(list));
                }
                sdm_cancelEdit();
                showModal("Laporan berhasil diperbarui!", 'alert');
            } else {
                sdm_saveToHistory(content, f);
                showModal("Laporan berhasil dibuat!", 'alert');
                sdm_resetSDMForm();
            }
        }

        function sdm_saveToHistory(content, data) {
            let list = JSON.parse(localStorage.getItem("sdm_history") || "[]");
            list.unshift({ id: Date.now(), content, data, time: new Date().toLocaleString() });
            localStorage.setItem("sdm_history", JSON.stringify(list));
            sdm_renderHistory();
        }

        function sdm_renderHistory() {
            const list = JSON.parse(localStorage.getItem("sdm_history") || "[]");
            const q = document.getElementById('sdm-searchQuery').value.toLowerCase();
            const fJenis = document.getElementById('sdm-filterJenis').value;
            const fKepada = document.getElementById('sdm-filterKepada').value;
            const cont = document.getElementById('sdm-history');

            const filtered = list.filter(item => {
                const matchesQ = item.content.toLowerCase().includes(q) || (item.data.jenis && item.data.jenis.toLowerCase().includes(q));
                const matchesJenis = !fJenis || item.data.jenis === fJenis;
                const matchesKepada = !fKepada || item.data.kepada === fKepada;
                return matchesQ && matchesJenis && matchesKepada;
            });

            cont.innerHTML = filtered.length ? filtered.map(item => `
                <div class="bg-white border p-4 rounded-xl shadow-sm flex flex-col gap-2">
                    <div class="flex justify-between items-start">
                        <div class="text-[10px] text-blue-600 font-bold uppercase tracking-wider">${item.time}</div>
                        <div class="text-[10px] bg-slate-100 px-2 py-0.5 rounded">${item.data.kepada}</div>
                    </div>
                    <div class="font-bold text-slate-800">${item.data.jenis}</div>
                    <div class="flex gap-2 mt-2">
                        <button onclick="sdm_viewFromHistory(${item.id})" class="text-xs bg-slate-100 hover:bg-slate-200 px-3 py-1.5 rounded-lg transition-all">Lihat</button>
                        <button onclick="sdm_editFromHistory(${item.id})" class="text-xs bg-yellow-100 text-yellow-700 hover:bg-yellow-200 px-3 py-1.5 rounded-lg transition-all">Edit</button>
                        <button onclick="sdm_deleteHistory(${item.id})" class="text-xs bg-red-100 text-red-700 hover:bg-red-200 px-3 py-1.5 rounded-lg transition-all">Hapus</button>
                    </div>
                </div>`).join('') : '<p class="text-center text-slate-400 text-xs py-4">Tidak ada riwayat laporan.</p>';

            // Populate Filters
            if (document.activeElement.id !== 'sdm-searchQuery') {
                const jenisTypes = [...new Set(list.map(i => i.data.jenis))];
                const kepadaTypes = [...new Set(list.map(i => i.data.kepada))];

                const sJ = document.getElementById('sdm-filterJenis');
                const vJ = sJ.value;
                sJ.innerHTML = '<option value="">Semua Kegiatan</option>' + jenisTypes.map(t => `<option value="${t}">${t}</option>`).join('');
                sJ.value = vJ;

                const sK = document.getElementById('sdm-filterKepada');
                const vK = sK.value;
                sK.innerHTML = '<option value="">Semua Tujuan</option>' + kepadaTypes.map(t => `<option value="${t}">${t}</option>`).join('');
                sK.value = vK;
            }
        }

        function sdm_viewFromHistory(id) {
            const item = JSON.parse(localStorage.getItem("sdm_history")).find(i => i.id == id);
            document.getElementById('sdm-reportDisplayArea').innerHTML = item.content.replace(/\n/g, '<br>');
            sdm_addWebWatermark();
            window.scrollTo({ top: document.getElementById('sdm-output').offsetTop - 20, behavior: 'smooth' });
        }

        function sdm_editFromHistory(id) {
            const item = JSON.parse(localStorage.getItem("sdm_history")).find(i => i.id == id);
            const d = item.data;
            document.getElementById('sdm-jenis').value = d.jenis;
            document.getElementById('sdm-kepada').value = d.kepada;
            document.getElementById('sdm-dari').value = d.dari;
            document.getElementById('sdm-tanggal').value = d.tgl;
            document.getElementById('sdm-waktu').value = d.wkt;
            document.getElementById('sdm-tempat').value = d.tmp;
            document.getElementById('sdm-pimpinan').value = d.pim;
            document.getElementById('sdm-hasil').value = d.hasil;
            document.getElementById('sdm-sapaan').value = d.sapaan || 'Komandan';

            const cont = document.getElementById('sdm-daftar-hadir-container');
            cont.innerHTML = '';
            d.peserta.forEach(p => sdm_tambahPeserta(p));

            document.getElementById('sdm-editingReportId').value = id;
            document.getElementById('sdm-mainActionButton').textContent = "Update Laporan";
            document.getElementById('sdm-cancelEditButton').style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function sdm_resetSDMForm() {
            document.getElementById('sdm-reportForm').reset();
            document.getElementById('sdm-daftar-hadir-container').innerHTML = '';
            sdm_tambahPeserta("Kasubbagmutjab Bag Binkar Ro SDM Polda Banten");
            document.getElementById('sdm-tanggal').valueAsDate = new Date();
        }

        function sdm_cancelEdit() {
            sdm_resetSDMForm();
            document.getElementById('sdm-editingReportId').value = '';
            document.getElementById('sdm-mainActionButton').textContent = "Buat Laporan";
            document.getElementById('sdm-cancelEditButton').style.display = 'none';
        }

        function sdm_deleteHistory(id) {
            showModal("Hapus laporan ini dari riwayat?", 'confirm', () => {
                let list = JSON.parse(localStorage.getItem("sdm_history") || "[]");
                localStorage.setItem("sdm_history", JSON.stringify(list.filter(i => i.id != id)));
                sdm_renderHistory();
            });
        }

        function sdm_clearAllHistory() {
            showModal("Hapus SEMUA riwayat laporan?", 'confirm', () => { localStorage.removeItem("sdm_history"); sdm_renderHistory(); });
        }

        async function sdm_elaborateHasil() {
            const jenis = document.getElementById('sdm-jenis').value;
            const hasil = document.getElementById('sdm-hasil').value;
            const btn = document.getElementById('sdm-elaborateHasilBtn');
            if (!hasil) return showModal("Isi ringkasan hasil terlebih dahulu.", "alert");

            btn.disabled = true; btn.textContent = "Processing...";
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: `Tolong elaborasi poin-poin hasil kegiatan ini menjadi bahasa laporan polisi yang formal, profesional, dan mendetail. Jenis Kegiatan: ${jenis}. Hasil: ${hasil}` }] }] })
                });
                const res = await response.json();
                document.getElementById('sdm-hasil').value = res.candidates[0].content.parts[0].text;
            } catch (e) { console.error(e); }
            btn.disabled = false; btn.textContent = "‚ú® Perluas Hasil (AI)";
        }

        function sdm_addWebWatermark() {
            const area = document.getElementById('sdm-reportDisplayArea');
            if (!area.querySelector('.web-watermark')) {
                const wm = document.createElement('div');
                wm.className = 'web-watermark';
                wm.textContent = 'Bripda MEEP';
                area.appendChild(wm);
            }
        }

        function sdm_downloadPDF() {
            const element = document.getElementById('sdm-reportDisplayArea');
            if (!element.innerHTML.trim()) return showModal("Belum ada laporan untuk diunduh.", "alert");

            // Temporary container for PDF to add watermark styling
            const printElement = document.createElement('div');
            printElement.innerHTML = element.innerHTML;
            const wm = document.createElement('div');
            wm.className = 'pdf-watermark';
            wm.textContent = 'Bripda MEEP';
            printElement.appendChild(wm);

            const opt = {
                margin: 0.5,
                filename: 'Laporan_SDM_Polda_Banten.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
            };
            html2pdf().from(printElement).set(opt).save();
        }

        function sdm_copyLaporan() {
            const area = document.getElementById('sdm-reportDisplayArea');
            if (!area.innerHTML.trim()) return showModal("Belum ada laporan untuk disalin.", "alert");
            const text = area.innerHTML.replace(/<br>/g, '\n').replace(/<[^>]+>/g, "");
            const t = document.createElement("textarea"); document.body.appendChild(t); t.value = text; t.select(); document.execCommand("copy"); document.body.removeChild(t);
            showModal("Teks laporan berhasil disalin!", 'alert');
        }

        // --- Initialization ---
        window.onload = function () {
            // App 1 Init
            pangan_addEntry('kp-lahan-list', 'Contoh: seluas 2 Ha');
            pangan_addEntry('kp-panen-list', 'Contoh: 2 Ton');
            document.getElementById('kp-tanggal').valueAsDate = new Date();

            // App 2 Init
            harian_addDataRows();
            document.getElementById('harian-addRowButton').onclick = harian_addDataRows;
            document.getElementById('harian-exportButton').onclick = harian_exportExcel;

            // App 3 Init
            sdm_tambahPeserta("Kasubbagmutjab Bag Binkar Ro SDM Polda Banten");
            sdm_renderHistory();
            document.getElementById('sdm-tanggal').valueAsDate = new Date();

            /* Particles.js Init */
            if (document.getElementById('particles-js')) {
                particlesJS("particles-js", {
                    "particles": {
                        "number": { "value": 80, "density": { "enable": true, "value_area": 800 } },
                        "color": { "value": "#4A90E2" },
                        "shape": { "type": "circle", "stroke": { "width": 0, "color": "#000000" }, "polygon": { "nb_sides": 5 } },
                        "opacity": { "value": 0.5, "random": false, "anim": { "enable": false, "speed": 1, "opacity_min": 0.1, "sync": false } },
                        "size": { "value": 5, "random": true, "anim": { "enable": false, "speed": 40, "size_min": 0.1, "sync": false } },
                        "line_linked": { "enable": true, "distance": 150, "color": "#4A90E2", "opacity": 0.4, "width": 1 },
                        "move": { "enable": true, "speed": 2, "direction": "none", "random": false, "straight": false, "out_mode": "out", "bounce": false, "attract": { "enable": false, "rotateX": 600, "rotateY": 1200 } }
                    },
                    "interactivity": {
                        "detect_on": "canvas",
                        "events": { "onhover": { "enable": true, "mode": "grab" }, "onclick": { "enable": true, "mode": "push" }, "resize": true },
                        "modes": { "grab": { "distance": 140, "line_linked": { "opacity": 1 } }, "bubble": { "distance": 400, "size": 40, "duration": 2, "opacity": 8, "speed": 3 }, "repulse": { "distance": 200, "duration": 0.4 }, "push": { "particles_nb": 4 }, "remove": { "particles_nb": 2 } }
                    },
                    "retina_detect": true
                });
            }
        };
    </script>
</body>

</html>
